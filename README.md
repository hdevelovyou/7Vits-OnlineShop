 
## Link Video Demo: https://drive.google.com/file/d/13kz2CLG9arfkaZd3emGMt4ww3VK_hakj/view?usp=sharing
## TÃ i khoáº£n Admin (Phá»¥c vá»¥ cho Demo sáº£n pháº©m)
username: admin

password: 7vitsAdmin321


<p align="center">
  <img src="./asset/7VITSnobg.png" alt="LOGO" width="250">
</p>

# Website mua bÃ¡n váº­t pháº©m, tÃ i sáº£n áº£o online - Made by 7VITS - 7vits.id.vn

## Giá»›i thiá»‡u Ä‘á»“ Ã¡n

Äá»“ Ã¡n nÃ y xÃ¢y dá»±ng má»™t **website sÃ n thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­** chuyÃªn dÃ nh cho cÃ¡c giao dá»‹ch **váº­t pháº©m áº£o** nhÆ° *key game*, *tÃ i khoáº£n game*, *CD-Key*, v.v.

Äiá»ƒm ná»•i báº­t cá»§a há»‡ thá»‘ng lÃ  mÃ´ hÃ¬nh giao dá»‹ch **"trustless"** â€“ tá»©c lÃ  **khÃ´ng yÃªu cáº§u cÃ¡c bÃªn pháº£i Ä‘áº·t niá»m tin vÃ o bÃªn trung gian hoáº·c vÃ o nhau**. Thay vÃ o Ä‘Ã³, niá»m tin Ä‘Æ°á»£c Ä‘áº£m báº£o thÃ´ng qua:

- **MÃ£ nguá»“n minh báº¡ch**
- **Thuáº­t toÃ¡n rÃµ rÃ ng**
- **CÆ¡ cháº¿ Ä‘á»“ng thuáº­n Ä‘Æ°á»£c thiáº¿t káº¿ cháº·t cháº½**

Website Ä‘Ã³ng vai trÃ² trung gian Ä‘áº£m báº£o giao dá»‹ch Ä‘Æ°á»£c thá»±c hiá»‡n Ä‘Ãºng cam káº¿t giá»¯a ngÆ°á»i mua vÃ  ngÆ°á»i bÃ¡n, thÃ´ng qua:

- **Há»£p Ä‘á»“ng thÃ´ng minh (Smart Contract)**  - Dá»± kiáº¿n phÃ¡t triá»ƒn trong tÆ°Æ¡ng lai gáº§n
- **CÆ¡ cháº¿ escrow phi táº­p trung**

CÆ¡ cháº¿ nÃ y giÃºp giáº£m thiá»ƒu rá»§i ro lá»«a Ä‘áº£o vÃ  gia tÄƒng tÃ­nh báº£o máº­t, minh báº¡ch trong tá»«ng giao dá»‹ch.

### GiÃ¡o viÃªn hÆ°á»›ng dáº«n
- Tráº§n Tuáº¥n DÅ©ng
### Lá»›p : NT208.P22.ANTT
### Nhom 7 - ThÃ nh viÃªn thá»±c hiÃªn:
+ 23520468	BÃ¹i Nguyá»…n CÃ´ng Hiáº¿u       -  hdevelovyou
+ 23521191	ChÃ¢u HoÃ ng PhÃºc            -  imtynn66
+ 23520166	Nguyá»…n Há»¯u Cáº£nh            -  BlankBire
+ 23520139	Tráº§n Gia Báº£o               -  rizy44
+ 23521080	Nguyá»…n Huá»³nh NhÃ¢n          -  Fin-tan

### Cáº¥u trÃºc Ä‘á»“ Ã¡n
Äá»“ Ã¡n gá»“m 2 pháº§n chÃ­nh:
-`\be` - Backend, sá»­ dung Nodejs/Express server
-`\fe` - Frontend, sá»­ dá»¥ng React application

## TÃ­nh nÄƒng chÃ­nh
![BussinessFunctionDiagram](./asset/Bussiness%20Function%20Diagram.png)
### Quáº£n lÃ½ ngÆ°á»i dÃ¹ng
- **ÄÄƒng kÃ½, Ä‘Äƒng nháº­p**: Há»— trá»£ Ä‘Äƒng nháº­p báº±ng email/máº­t kháº©u vÃ  OAuth (Google, Facebook).
- **Quáº£n lÃ½ tÃ i khoáº£n**: ThÃ´ng tin cÃ¡ nhÃ¢n, lá»‹ch sá»­ giao dá»‹ch, sá»‘ dÆ° vÃ­ Ä‘iá»‡n tá»­.
- **Há»‡ thá»‘ng Ä‘Ã¡nh giÃ¡**: ÄÃ¡nh giÃ¡ sáº£n pháº©m.
### Sáº£n pháº©m vÃ  giao dá»‹ch
- **Mua bÃ¡n sáº£n pháº©m áº£o**: ÄÄƒng bÃ¡n, tÃ¬m kiáº¿m, lá»c sáº£n pháº©m theo danh má»¥c.
- **VÃ­ Ä‘iá»‡n tá»­**: Náº¡p tiá»n vÃ  thanh toÃ¡n trá»±c tuyáº¿n qua vÃ­ ná»™i bá»™ hoáº·c VNPay.
- **Há»‡ thá»‘ng Ä‘Æ¡n hÃ ng**: Quáº£n lÃ½ Ä‘Æ¡n hÃ ng, theo dÃµi tráº¡ng thÃ¡i giao dá»‹ch.
- **Há»‡ thá»‘ng thanh toÃ¡n**: Há»— trá»£ phÆ°Æ¡ng thá»©c thanh toÃ¡n escrow an toÃ n vÃ  báº£o máº­t.
   + Escrow lÃ  má»™t cÆ¡ cháº¿ thanh toÃ¡n trung gian, nÆ¡i tiá»n cá»§a ngÆ°á»i mua Ä‘Æ°á»£c giá»¯ táº¡m thá»i trong má»™t khu vá»±c an toÃ n (vÃ­ dá»¥ nhÆ° locked_balance) cho Ä‘áº¿n khi Ä‘iá»u kiá»‡n cá»¥ thá»ƒ Ä‘Æ°á»£c Ä‘Ã¡p á»©ng
### Äáº¥u giÃ¡
- **Há»‡ thá»‘ng Ä‘áº¥u giÃ¡**: ÄÄƒng Ä‘áº¥u giÃ¡ sáº£n pháº©m, Ä‘áº·t giÃ¡, theo dÃµi phiÃªn Ä‘áº¥u giÃ¡ theo thá»i gian thá»±c.

### Báº£o máº­t vÃ  truyá»n thÃ´ng
- **Chat trá»±c tiáº¿p**: TrÃ² chuyá»‡n thá»i gian thá»±c giá»¯a cÃ¡c ngÆ°á»i dÃ¹ng, cÃ³ thá»ƒ gá»­i sticker, áº£nh.
- **Há»‡ thá»‘ng báº£o máº­t**: XÃ¡c thá»±c OTP, báº£o vá»‡ giao dá»‹ch, cÆ¡ cháº¿ escrow (trung gian).



## Cáº¥u trÃºc cÆ¡ sá»Ÿ dá»¯ liá»‡u
![database](./asset/data.jpeg)
## CÃ i Ä‘áº·t vÃ  cháº¡y dá»± Ã¡n

### YÃªu cáº§u
- Node.js (v16+)
- MySQL
- Git
- Táº¡o tÃ i khoáº£n mÃ´i trÆ°á»ng test trÃªn VNPay táº¡i https://sandbox.vnpayment.vn/devreg/
- Táº¡o tÃ i khoáº£n Google - 
- 

### Backend
```bash
# Di chuyá»ƒn vÃ o thÆ° má»¥c backend
cd be

# CÃ i Ä‘áº·t cÃ¡c dependencies
npm install


# Táº¡o file .env vá»›i cÃ¡c biáº¿n mÃ´i trÆ°á»ng cáº§n thiáº¿t
GOOGLE_CLIENT_ID=your_google_client_id_here
GOOGLE_CLIENT_SECRET=your_google_client_secret_here
API_URL=http://localhost:5000
CLIENT_URL=http://localhost:3000

EMAIL_PASSWORD=your_email_app_password_here
EMAIL_USERNAME=your_email@gmail.com

DB_HOST=your_database_host
DB_USER=your_database_username
DB_PASSWORD=your_database_password
DB_NAME=your_database_name
DB_PORT=your_database_port

GEMINI_API_KEY=your_gemini_api_key_here
PORT=5000
# Cháº¡y server á»Ÿ cháº¿ Ä‘á»™ development
npm run dev
```

### Frontend
```bash
# Di chuyá»ƒn vÃ o thÆ° má»¥c frontend
cd fe

# CÃ i Ä‘áº·t cÃ¡c dependencies
npm install

# Táº¡o file .env vá»›i cÃ¡c biáº¿n mÃ´i trÆ°á»ng cáº§n thiáº¿t
DANGEROUSLY_DISABLE_HOST_CHECK=true
REACT_APP_API_URL=http://localhost:5000

# Cháº¡y á»©ng dá»¥ng React á»Ÿ cháº¿ Ä‘á»™ development
npm start
```
## MiÃªu táº£ chi tiáº¿t cÃ¡c chá»©c nÄƒng chÃ­nh

### ÄÄƒng nháº­p Google (Google OAuth Authentication)

#### Tá»•ng quan
Há»‡ thá»‘ng tÃ­ch há»£p chá»©c nÄƒng Ä‘Äƒng nháº­p Google OAuth 2.0, cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p nhanh chÃ³ng vÃ  an toÃ n báº±ng tÃ i khoáº£n Google cá»§a há» mÃ  khÃ´ng cáº§n táº¡o tÃ i khoáº£n má»›i.

#### Quy trÃ¬nh hoáº¡t Ä‘á»™ng

##### 1. Khá»Ÿi táº¡o Ä‘Äƒng nháº­p
- NgÆ°á»i dÃ¹ng nháº¥p vÃ o nÃºt "ÄÄƒng nháº­p vá»›i Google" 
- Há»‡ thá»‘ng chuyá»ƒn hÆ°á»›ng tá»›i `${API_URL}/api/auth/google`
- Server sá»­ dá»¥ng Passport.js vá»›i GoogleStrategy Ä‘á»ƒ xá»­ lÃ½ OAuth

##### 2. XÃ¡c thá»±c vá»›i Google
- Google hiá»ƒn thá»‹ trang Ä‘á»“ng Ã½ quyá»n truy cáº­p (scope: profile, email)
- NgÆ°á»i dÃ¹ng xÃ¡c nháº­n vÃ  cáº¥p quyá»n
- Google callback tá»›i `${API_URL}/api/auth/google/callback`

##### 3. Xá»­ lÃ½ sau xÃ¡c thá»±c
**TrÆ°á»ng há»£p 1: NgÆ°á»i dÃ¹ng má»›i**
- Táº¡o tÃ i khoáº£n má»›i vá»›i thÃ´ng tin tá»« Google
- Tá»± Ä‘á»™ng táº¡o vÃ­ Ä‘iá»‡n tá»­ vá»›i sá»‘ dÆ° 0
- YÃªu cáº§u thiáº¿t láº­p username vÃ  password (chuyá»ƒn hÆ°á»›ng tá»›i trang setup)

**TrÆ°á»ng há»£p 2: NgÆ°á»i dÃ¹ng Ä‘Ã£ tá»“n táº¡i**
- LiÃªn káº¿t Google ID vá»›i tÃ i khoáº£n hiá»‡n cÃ³
- ÄÄƒng nháº­p trá»±c tiáº¿p vÃ  chuyá»ƒn hÆ°á»›ng vá» trang chÃ­nh

##### 4. HoÃ n táº¥t Ä‘Äƒng nháº­p
- Táº¡o JWT token vá»›i thá»i gian háº¿t háº¡n 24h
- LÆ°u thÃ´ng tin ngÆ°á»i dÃ¹ng vÃ o localStorage
- Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Äƒng nháº­p trong á»©ng dá»¥ng

#### TÃ­nh nÄƒng báº£o máº­t
- **Token JWT**: Báº£o máº­t vÃ  xÃ¡c thá»±c phiÃªn lÃ m viá»‡c
- **Xá»­ lÃ½ lá»—i**: ThÃ´ng bÃ¡o rÃµ rÃ ng khi cÃ³ xung Ä‘á»™t email hoáº·c lá»—i xÃ¡c thá»±c
- **Validation**: Kiá»ƒm tra vÃ  xÃ¡c thá»±c thÃ´ng tin tá»« Google

#### CÃ´ng nghá»‡ sá»­ dá»¥ng
- **Backend**: Passport.js, passport-google-oauth20, JWT
- **Frontend**: React Router, Axios
- **Database**: MySQL vá»›i báº£ng users há»— trá»£ googleId

---

### ÄÄƒng bÃ¡n sáº£n pháº©m (Product Listing)

#### Tá»•ng quan
Chá»©c nÄƒng cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘Äƒng bÃ¡n cÃ¡c sáº£n pháº©m áº£o nhÆ° Game Key, Account Game, CD-Key vá»›i giao diá»‡n thÃ¢n thiá»‡n vÃ  quy trÃ¬nh Ä‘Æ¡n giáº£n.

#### Quy trÃ¬nh Ä‘Äƒng sáº£n pháº©m

##### 1. Truy cáº­p trang Ä‘Äƒng bÃ¡n
- ÄÆ°á»ng dáº«n: `/sell-product`
- YÃªu cáº§u: Pháº£i Ä‘Äƒng nháº­p (cÃ³ JWT token)
- Giao diá»‡n: Form chi tiáº¿t vá»›i validation

##### 2. Nháº­p thÃ´ng tin sáº£n pháº©m
**ThÃ´ng tin báº¯t buá»™c:**
- **TÃªn sáº£n pháº©m**: TiÃªu Ä‘á» mÃ´ táº£ sáº£n pháº©m
- **MÃ´ táº£ chi tiáº¿t**: ThÃ´ng tin vá» sáº£n pháº©m
- **GiÃ¡ bÃ¡n**: Äá»‹nh dáº¡ng VNÄ vá»›i separator (tá»± Ä‘á»™ng format)
- **Danh má»¥c**: Lá»±a chá»n tá»« dropdown (Game Key, App Key, Account)
- **Ghi chÃº**: ThÃ´ng tin key/tÃ i khoáº£n sáº½ giao cho buyer

**ThÃ´ng tin tÃ¹y chá»n:**
- **HÃ¬nh áº£nh**: Upload áº£nh sáº£n pháº©m (há»— trá»£ JPG, PNG, GIF, WEBP, tá»‘i Ä‘a 2MB)

##### 3. Upload vÃ  xá»­ lÃ½ hÃ¬nh áº£nh
- Kiá»ƒm tra Ä‘á»‹nh dáº¡ng file vÃ  kÃ­ch thÆ°á»›c
- Chuyá»ƒn Ä‘á»•i sang Base64 Ä‘á»ƒ lÆ°u trá»¯
- Hiá»ƒn thá»‹ preview trÆ°á»›c khi submit

##### 4. Validation vÃ  lÆ°u trá»¯
**Backend validation:**
- Kiá»ƒm tra quyá»n truy cáº­p (JWT token)
- Validate cÃ¡c trÆ°á»ng báº¯t buá»™c
- Xá»­ lÃ½ vÃ  lÆ°u vÃ o database

**Database operations:**
- Insert vÃ o báº£ng `products` vá»›i `seller_id`
- Tá»± Ä‘á»™ng set `stock = 1` vÃ  `status = 'active'`
- LÆ°u image dÆ°á»›i dáº¡ng Base64 string

##### 5. Quáº£n lÃ½ sáº£n pháº©m Ä‘Ã£ Ä‘Äƒng
- Xem danh sÃ¡ch sáº£n pháº©m táº¡i `/my-products`
- Chá»‰nh sá»­a thÃ´ng tin sáº£n pháº©m
- Thay Ä‘á»•i tráº¡ng thÃ¡i (active/inactive)
- XÃ³a sáº£n pháº©m náº¿u chÆ°a cÃ³ Ä‘Æ¡n hÃ ng

#### TÃ­nh nÄƒng ná»•i báº­t
- **Real-time validation**: Kiá»ƒm tra dá»¯ liá»‡u ngay khi nháº­p
- **Price formatting**: Tá»± Ä‘á»™ng format giÃ¡ vá»›i dáº¥u cháº¥m phÃ¢n cÃ¡ch
- **Image optimization**: Tá»± Ä‘á»™ng resize vÃ  tá»‘i Æ°u áº£nh
- **Security**: Chá»‰ chá»§ sáº£n pháº©m má»›i cÃ³ thá»ƒ chá»‰nh sá»­a

---

### Chat Bot AI (VitBot)

#### Tá»•ng quan
VitBot lÃ  trá»£ lÃ½ AI thÃ´ng minh Ä‘Æ°á»£c phÃ¡t triá»ƒn báº±ng Google Gemini AI, há»— trá»£ khÃ¡ch hÃ ng 24/7 vá»›i kháº£ nÄƒng tÆ° váº¥n sáº£n pháº©m, chÃ­nh sÃ¡ch vÃ  hÆ°á»›ng dáº«n mua hÃ ng.

#### TÃ­nh nÄƒng chÃ­nh

##### 1. Giao diá»‡n Chat
- **Floating button**: Biá»ƒu tÆ°á»£ng chat ná»•i á»Ÿ gÃ³c mÃ n hÃ¬nh
- **Responsive design**: Tá»± Ä‘á»™ng áº©n hiá»‡n trÃªn cÃ¡c trang khÃ¡c nhau
- **Modern UI**: Giao diá»‡n Ä‘áº¹p vá»›i animation mÆ°á»£t mÃ 

##### 2. Kháº£ nÄƒng há»— trá»£
**TÆ° váº¥n chÃ­nh sÃ¡ch:**
- ChÃ­nh sÃ¡ch Ä‘á»•i tráº£ (7 ngÃ y)
- Quy Ä‘á»‹nh báº£o hÃ nh sáº£n pháº©m
- ChÃ­nh sÃ¡ch rÃºt tiá»n cho ngÆ°á»i bÃ¡n
- Äiá»u khoáº£n sá»­ dá»¥ng

**HÆ°á»›ng dáº«n mua hÃ ng:**
- Quy trÃ¬nh thanh toÃ¡n
- CÃ¡ch nháº­n sáº£n pháº©m
- HÆ°á»›ng dáº«n náº¡p tiá»n vÃ­
- CÃ¡ch Ä‘Ã¡nh giÃ¡ sáº£n pháº©m

**ThÃ´ng tin liÃªn há»‡:**
- Hotline: 1900-7777
- Email: 7vits.shop@gmail.com
- Fanpage: 7VITS
- Thá»i gian há»— trá»£: 8h-22h

##### 3. CÃ´ng nghá»‡ AI

**Google Gemini Integration:**
- Model: gemini-1.5-flash (latest)
- API Key authentication
- Context-aware responses

**Conversation Management:**
- LÆ°u lá»‹ch sá»­ há»™i thoáº¡i trong session
- Context switching cho cÃ¢u há»i liÃªn quan
- Memory cá»§a cuá»™c há»™i thoáº¡i trÆ°á»›c Ä‘Ã³

**Prompt Engineering:**
```
CUSTOMER_SUPPORT_PROMPT = Detailed system prompt defining:
- Bot personality (VitBot - thÃ¢n thiá»‡n, chuyÃªn nghiá»‡p)
- Shop information (7Vits, chÃ­nh sÃ¡ch, liÃªn há»‡)
- Response guidelines (tiáº¿ng Viá»‡t, chi tiáº¿t, hÆ°á»›ng dáº«n)
- Shop policies (Ä‘á»•i tráº£, báº£o hÃ nh, quy Ä‘á»‹nh...)
```

##### 4. TÃ­nh nÄƒng tÆ°Æ¡ng tÃ¡c

**Quick Questions:**
- "ChÃ­nh sÃ¡ch Ä‘á»•i tráº£ nhÆ° tháº¿ nÃ o?"
- "CÃ¡ch mua tÃ i khoáº£n game?"
- "CÃ¡ch thanh toÃ¡n online?"
- "Thá»i gian báº£o hÃ nh bao lÃ¢u?"

**Message Features:**
- Real-time typing
- Message timestamp
- Error handling vá»›i retry
- Loading indicators

**Conversation Controls:**
- Reset conversation
- Message history
- Scroll to latest message
- Auto-focus input

##### 5. Backend API

**Endpoint: `/api/chatbot/message`**
```javascript
{
  message: "CÃ¢u há»i cá»§a user",
  conversationHistory: [
    { role: "user", content: "..." },
    { role: "assistant", content: "..." }
  ]
}
```

**Response Format:**
```javascript
{
  success: true,
  response: "CÃ¢u tráº£ lá»i tá»« AI",
  timestamp: "2024-01-01T00:00:00.000Z"
}
```

##### 6. Error Handling
- **API Key validation**: Kiá»ƒm tra Gemini API key
- **Rate limiting**: Xá»­ lÃ½ giá»›i háº¡n API calls
- **Network errors**: ThÃ´ng bÃ¡o lá»—i máº¡ng
- **Graceful degradation**: Fallback khi AI khÃ´ng kháº£ dá»¥ng
---
### Mua hÃ ng, Thanh toÃ¡n
#### 1. Tá»•ng quan chá»©c nÄƒng
Há»‡ thá»‘ng thanh toÃ¡n cá»§a 7VITS Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn cÆ¡ cháº¿ escrow, Ä‘áº£m báº£o an toÃ n cho cáº£ ngÆ°á»i mua vÃ  ngÆ°á»i bÃ¡n thÃ´ng qua viá»‡c khÃ³a tiá»n trong quÃ¡ trÃ¬nh giao dá»‹ch.

#### 2. Quy trÃ¬nh thanh toÃ¡n chi tiáº¿t

##### 2.1. Khá»Ÿi táº¡o Ä‘Æ¡n hÃ ng
- NgÆ°á»i dÃ¹ng chá»n sáº£n pháº©m vÃ  gá»­i yÃªu cáº§u táº¡o Ä‘Æ¡n hÃ ng
- Backend nháº­n thÃ´ng tin gá»“m danh sÃ¡ch sáº£n pháº©m (`items`) vÃ  tá»•ng tiá»n (`totalAmount`)
- Há»‡ thá»‘ng táº¡o `idempotencyKey` Ä‘á»ƒ Ä‘áº£m báº£o khÃ´ng xá»­ lÃ½ trÃ¹ng láº·p Ä‘Æ¡n hÃ ng

##### 2.2. Kiá»ƒm tra Ä‘iá»u kiá»‡n trÆ°á»›c giao dá»‹ch
- XÃ¡c thá»±c danh sÃ¡ch sáº£n pháº©m tá»“n táº¡i vÃ  cÃ²n hÃ ng (`status = 'active'`)
- Kiá»ƒm tra ngÆ°á»i mua khÃ´ng pháº£i lÃ  ngÆ°á»i bÃ¡n
- Äáº£m báº£o táº¥t cáº£ sáº£n pháº©m Ä‘á»u tá»« cÃ¹ng má»™t ngÆ°á»i bÃ¡n
- Kiá»ƒm tra sá»‘ dÆ° vÃ­ cá»§a ngÆ°á»i mua Ä‘á»§ Ä‘á»ƒ thanh toÃ¡n

##### 2.3. Xá»­ lÃ½ giao dá»‹ch vá»›i Transaction Database
Há»‡ thá»‘ng sá»­ dá»¥ng transaction SQL Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n dá»¯ liá»‡u:

1. **KhÃ³a vÃ­ ngÆ°á»i dÃ¹ng**: KhÃ³a vÃ­ ngÆ°á»i mua vÃ  ngÆ°á»i bÃ¡n theo thá»© tá»± ID tÄƒng dáº§n Ä‘á»ƒ trÃ¡nh deadlock
2. **Kiá»ƒm tra sá»‘ dÆ°**: XÃ¡c nháº­n sá»‘ dÆ° ngÆ°á»i mua Ä‘á»§ Ä‘á»ƒ thá»±c hiá»‡n giao dá»‹ch
3. **KhÃ³a sáº£n pháº©m**: KhÃ³a cÃ¡c sáº£n pháº©m Ä‘Æ°á»£c mua Ä‘á»ƒ trÃ¡nh bÃ¡n trÃ¹ng láº·p
4. **Táº¡o Ä‘Æ¡n hÃ ng**: LÆ°u thÃ´ng tin Ä‘Æ¡n hÃ ng vá»›i tráº¡ng thÃ¡i "pending"
5. **Táº¡o chi tiáº¿t Ä‘Æ¡n hÃ ng**: LÆ°u danh sÃ¡ch sáº£n pháº©m thuá»™c Ä‘Æ¡n hÃ ng
6. **Cáº­p nháº­t vÃ­ theo cÆ¡ cháº¿ Escrow**:
   - Trá»« tiá»n tá»« vÃ­ ngÆ°á»i mua
   - Chuyá»ƒn vÃ o locked_balance cá»§a ngÆ°á»i bÃ¡n (chÆ°a nháº­n Ä‘Æ°á»£c ngay)
7. **Cáº­p nháº­t tráº¡ng thÃ¡i sáº£n pháº©m**: ÄÃ¡nh dáº¥u sáº£n pháº©m thÃ nh "inactive" Ä‘á»ƒ khÃ´ng hiá»ƒn thá»‹ cho ngÆ°á»i khÃ¡c
8. **Táº¡o báº£n ghi giao dá»‹ch**: Ghi nháº­n giao dá»‹ch mua hÃ ng vÃ  thu nháº­p cho ngÆ°á»i bÃ¡n (pending)

##### 2.4. Xá»­ lÃ½ sau giao dá»‹ch
- Há»‡ thá»‘ng cÃ³ cÆ¡ cháº¿ retry khi xáº£y ra deadlock hoáº·c timeout (tá»‘i Ä‘a 3 láº§n)
- Náº¿u cÃ³ lá»—i, toÃ n bá»™ giao dá»‹ch Ä‘Æ°á»£c rollback Ä‘á»ƒ Ä‘áº£m báº£o dá»¯ liá»‡u nháº¥t quÃ¡n
- HÃ m `cleanupFailedOrder` dá»n dáº¹p dá»¯ liá»‡u náº¿u Ä‘Æ¡n hÃ ng bá»‹ lá»—i

##### 2.5. XÃ¡c nháº­n Ä‘Æ¡n hÃ ng vÃ  hoÃ n táº¥t thanh toÃ¡n
Sau khi ngÆ°á»i mua nháº­n Ä‘Æ°á»£c sáº£n pháº©m vÃ  xÃ¡c nháº­n:
- Chuyá»ƒn tiá»n tá»« locked_balance sang balance cá»§a ngÆ°á»i bÃ¡n
- Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vÃ  giao dá»‹ch thÃ nh "completed"
- ÄÃ¡nh dáº¥u sáº£n pháº©m Ä‘Ã£ bÃ¡n vá»›i tráº¡ng thÃ¡i "sold_out"

##### 2.6. Xá»­ lÃ½ tá»« chá»‘i Ä‘Æ¡n hÃ ng
Náº¿u cÃ³ váº¥n Ä‘á», ngÆ°á»i mua cÃ³ thá»ƒ tá»« chá»‘i Ä‘Æ¡n hÃ ng:
- HoÃ n tiá»n tá»« locked_balance cá»§a ngÆ°á»i bÃ¡n vá» balance ngÆ°á»i mua
- Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vÃ  giao dá»‹ch thÃ nh "cancelled"
- Äáº·t láº¡i tráº¡ng thÃ¡i sáº£n pháº©m thÃ nh "active" Ä‘á»ƒ cÃ³ thá»ƒ bÃ¡n láº¡i

#### 3. API Backend chÃ­nh
- `POST /api/orders/create`: Táº¡o Ä‘Æ¡n hÃ ng má»›i
- `GET /api/orders/user`: Láº¥y danh sÃ¡ch Ä‘Æ¡n hÃ ng cá»§a ngÆ°á»i dÃ¹ng
- `PUT /api/orders/:id/confirm`: XÃ¡c nháº­n Ä‘Ã£ nháº­n sáº£n pháº©m
- `PUT /api/orders/:id/reject`: Tá»« chá»‘i Ä‘Æ¡n hÃ ng vÃ  yÃªu cáº§u hoÃ n tiá»n
- `GET /api/orders/:id`: Láº¥y chi tiáº¿t Ä‘Æ¡n hÃ ng
- `GET /api/wallet/balance`: Láº¥y sá»‘ dÆ° vÃ­ hiá»‡n táº¡i

### Náº¡p tiá»n báº±ng VNPay
####  **TÃ i khoáº£n test thanh toÃ¡n**
<table>
  <tr>
    <th colspan="2" style="text-align:center;">ğŸªª ThÃ´ng tin tháº»</th>
  </tr>
  <tr>
    <td><b>NgÃ¢n hÃ ng</b></td><td>NCB</td>
  </tr>
  <tr>
    <td><b>Sá»‘ tháº»</b></td><td>9704198526191432198</td>
  </tr>
  <tr>
    <td><b>TÃªn chá»§ tháº»</b></td><td>NGUYEN VAN A</td>
  </tr>
  <tr>
    <td><b>NgÃ y phÃ¡t hÃ nh</b></td><td>07/15</td>
  </tr>
  <tr>
    <td><b>Máº­t kháº©u OTP</b></td><td>123456</td>
  </tr>
</table>

#### Quy trÃ¬nh náº¡p tiá»n
![vnpay-flow](./asset/flow-pay.png)
##### 1. Khá»Ÿi táº¡o giao dá»‹ch
- NgÆ°á»i dÃ¹ng truy cáº­p trang "Náº¡p tiá»n" tá»« trang cÃ¡ nhÃ¢n
- Nháº­p sá»‘ tiá»n muá»‘n náº¡p 

##### 2. Táº¡o yÃªu cáº§u thanh toÃ¡n
- Backend táº¡o mÃ£ giao dá»‹ch duy nháº¥t (txnRef)
- Thiáº¿t láº­p cÃ¡c tham sá»‘ VNPay (amount, returnUrl, ipAddr, etc.)
- Táº¡o chá»¯ kÃ½ sá»‘ (secureHash) Ä‘á»ƒ báº£o máº­t giao dá»‹ch
- LÆ°u thÃ´ng tin giao dá»‹ch vÃ o báº£ng transactions vá»›i tráº¡ng thÃ¡i "pending"

##### 3. Chuyá»ƒn hÆ°á»›ng Ä‘áº¿n VNPay
- NgÆ°á»i dÃ¹ng Ä‘Æ°á»£c chuyá»ƒn hÆ°á»›ng Ä‘áº¿n cá»•ng thanh toÃ¡n VNPay
- Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n (tháº» ATM, tháº» tÃ­n dá»¥ng, QR code)
- Nháº­p thÃ´ng tin tháº» vÃ  xÃ¡c thá»±c OTP

##### 4. Xá»­ lÃ½ káº¿t quáº£ thanh toÃ¡n
- Server nháº­n thÃ´ng tin tá»« VNPay qua returnUrl
- XÃ¡c thá»±c chá»¯ kÃ½ vÃ  thÃ´ng tin giao dá»‹ch
- Kiá»ƒm tra tráº¡ng thÃ¡i thanh toÃ¡n tá»« VNPay

**Xá»­ lÃ½ thÃ nh cÃ´ng:**
- Cáº­p nháº­t tráº¡ng thÃ¡i giao dá»‹ch thÃ nh "completed"
- Cá»™ng tiá»n vÃ o vÃ­ ngÆ°á»i dÃ¹ng (balance)
- Táº¡o lá»‹ch sá»­ giao dá»‹ch vá»›i loáº¡i "deposit"
- Hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ nh cÃ´ng vÃ  sá»‘ dÆ° má»›i

**Xá»­ lÃ½ tháº¥t báº¡i:**
- Cáº­p nháº­t tráº¡ng thÃ¡i giao dá»‹ch thÃ nh "failed"
- Ghi log lá»—i Ä‘á»ƒ kiá»ƒm tra sau
- Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i vÃ  hÆ°á»›ng dáº«n thá»­ láº¡i

### Äáº¥u giÃ¡
1. **Táº¡o phiÃªn Ä‘áº¥u giÃ¡**
   - NgÆ°á»i dÃ¹ng Ä‘Äƒng sáº£n pháº©m Ä‘á»ƒ Ä‘áº¥u giÃ¡
   - Thiáº¿t láº­p giÃ¡ khá»Ÿi Ä‘iá»ƒm vÃ  thá»i gian káº¿t thÃºc
   - Cung cáº¥p mÃ´ táº£ chi tiáº¿t vÃ  hÃ¬nh áº£nh sáº£n pháº©m
   - Há»‡ thá»‘ng táº¡o phiÃªn Ä‘áº¥u giÃ¡ vá»›i tráº¡ng thÃ¡i "ongoing"

2. **Tham gia Ä‘áº¥u giÃ¡**
   - NgÆ°á»i dÃ¹ng xem danh sÃ¡ch cÃ¡c phiÃªn Ä‘áº¥u giÃ¡ Ä‘ang diá»…n ra
   - Äáº·t giÃ¡ cao hÆ¡n giÃ¡ hiá»‡n táº¡i (há»‡ thá»‘ng kiá»ƒm tra sá»‘ dÆ° vÃ  tÃ­nh há»£p lá»‡)
   - Theo dÃµi tráº¡ng thÃ¡i Ä‘áº¥u giÃ¡ theo thá»i gian thá»±c
   - Nháº­n thÃ´ng bÃ¡o khi cÃ³ ngÆ°á»i Ä‘áº·t giÃ¡ cao hÆ¡n

3. **Káº¿t thÃºc Ä‘áº¥u giÃ¡**
   - Há»‡ thá»‘ng tá»± Ä‘á»™ng xÃ¡c Ä‘á»‹nh ngÆ°á»i tháº¯ng cuá»™c khi Ä‘áº¿n thá»i gian káº¿t thÃºc
   - Trá»« tiá»n tá»« tÃ i khoáº£n ngÆ°á»i tháº¯ng vÃ  chuyá»ƒn vÃ o locked_balance ngÆ°á»i bÃ¡n
   - Táº¡o Ä‘Æ¡n hÃ ng tá»± Ä‘á»™ng vá»›i tráº¡ng thÃ¡i pending
   - Gá»­i thÃ´ng bÃ¡o cho ngÆ°á»i tháº¯ng vÃ  ngÆ°á»i bÃ¡n

4. **Xá»­ lÃ½ sau Ä‘áº¥u giÃ¡**
   - XÃ¡c nháº­n giao nháº­n sáº£n pháº©m theo quy trÃ¬nh mua hÃ ng thÃ´ng thÆ°á»ng
   - HoÃ n tiá»n náº¿u cÃ³ tranh cháº¥p hoáº·c há»§y Ä‘áº¥u giÃ¡

### Chat giá»¯a user
1. **Káº¿t ná»‘i ngÆ°á»i dÃ¹ng**
   - Táº¡o kÃªnh chat giá»¯a ngÆ°á»i mua vÃ  ngÆ°á»i bÃ¡n
   - Hiá»ƒn thá»‹ tráº¡ng thÃ¡i online/offline cá»§a ngÆ°á»i dÃ¹ng
   - ThÃ´ng bÃ¡o khi cÃ³ tin nháº¯n má»›i

2. **TÃ­nh nÄƒng chat**
   - Gá»­i tin nháº¯n vÄƒn báº£n theo thá»i gian thá»±c
   - Chia sáº» hÃ¬nh áº£nh vÃ  sticker
   - Xem lá»‹ch sá»­ tin nháº¯n trÆ°á»›c Ä‘Ã³
   - ThÃ´ng bÃ¡o Ä‘Ã£ xem tin nháº¯n

3. **Báº£o máº­t vÃ  quáº£n lÃ½**
   - MÃ£ hÃ³a tin nháº¯n
   - LÆ°u trá»¯ lá»‹ch sá»­ chat an toÃ n
   - BÃ¡o cÃ¡o ngÆ°á»i dÃ¹ng vi pháº¡m
   - Cháº·n ngÆ°á»i dÃ¹ng khÃ´ng mong muá»‘n

4. **TÃ­ch há»£p vá»›i giao dá»‹ch**
   - Trao Ä‘á»•i thÃ´ng tin vá» sáº£n pháº©m
   - ÄÃ m phÃ¡n giÃ¡ cáº£
   - Chia sáº» mÃ£ xÃ¡c thá»±c sáº£n pháº©m
   - Há»— trá»£ giáº£i quyáº¿t váº¥n Ä‘á» sau khi mua hÃ ng

## CÃ´ng nghá»‡ sá»­ dá»¥ng

### Frontend
- **React**: ThÆ° viá»‡n xÃ¢y dá»±ng giao diá»‡n ngÆ°á»i dÃ¹ng
- **React Router**: Quáº£n lÃ½ Ä‘á»‹nh tuyáº¿n vÃ  Ä‘iá»u hÆ°á»›ng
- **Axios**: Xá»­ lÃ½ cÃ¡c yÃªu cáº§u HTTP
- **SCSS/Sass**: Tiá»n xá»­ lÃ½ CSS Ä‘á»ƒ táº¡o kiá»ƒu
- **Socket.io-client**: Giao tiáº¿p thá»i gian thá»±c (chat, thÃ´ng bÃ¡o)
- **Redux/Redux Toolkit**: Quáº£n lÃ½ tráº¡ng thÃ¡i toÃ n cá»¥c
- **React Query**: Quáº£n lÃ½ tráº¡ng thÃ¡i mÃ¡y chá»§ vÃ  bá»™ nhá»› Ä‘á»‡m
- **Material-UI**: ThÆ° viá»‡n thÃ nh pháº§n giao diá»‡n
- **Formik & Yup**: Xá»­ lÃ½ form vÃ  xÃ¡c thá»±c
- **React Icons**: ThÆ° viá»‡n biá»ƒu tÆ°á»£ng
- **React Toastify**: ThÃ´ng bÃ¡o toast

### Backend
- **Node.js/Express**: Framework mÃ¡y chá»§ web
- **MySQL**: Há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡
- **JWT (JSON Web Tokens)**: XÃ¡c thá»±c ngÆ°á»i dÃ¹ng
- **Bcrypt**: MÃ£ hÃ³a máº­t kháº©u
- **Socket.io**: Xá»­ lÃ½ káº¿t ná»‘i thá»i gian thá»±c
- **Nodemailer**: Gá»­i email thÃ´ng bÃ¡o vÃ  xÃ¡c thá»±c
- **VNPay API**: TÃ­ch há»£p cá»•ng thanh toÃ¡n
- **Multer**: Xá»­ lÃ½ táº£i lÃªn tá»‡p
- **Cors**: Chia sáº» tÃ i nguyÃªn Ä‘a nguá»“n gá»‘c
- **Dotenv**: Quáº£n lÃ½ biáº¿n mÃ´i trÆ°á»ng
- **Node-cron**: Láº­p lá»‹ch tÃ¡c vá»¥ tá»± Ä‘á»™ng
- **Express-validator**: Middleware xÃ¡c thá»±c
- **Morgan**: Ghi log yÃªu cáº§u HTTP
- **Helmet**: Middleware báº£o máº­t

### CÃ´ng cá»¥ phÃ¡t triá»ƒn
- **Git**: Quáº£n lÃ½ phiÃªn báº£n
- **npm**: Quáº£n lÃ½ gÃ³i
- **ESLint**: Kiá»ƒm tra mÃ£
- **Prettier**: Äá»‹nh dáº¡ng mÃ£
- **Postman**: Kiá»ƒm thá»­ API
- **MySQL Workbench**: Quáº£n lÃ½ cÆ¡ sá»Ÿ dá»¯ liá»‡u
- **VS Code**: MÃ´i trÆ°á»ng phÃ¡t triá»ƒn tÃ­ch há»£p

### Triá»ƒn khai & LÆ°u trá»¯
- **Vercel**: LÆ°u trá»¯ Frontend
- **Railway**: LÆ°u trá»¯ Backend
- **MySQL Hosting**: LÆ°u trá»¯ cÆ¡ sá»Ÿ dá»¯ liá»‡u
- **Cloudinary**: LÆ°u trá»¯ hÃ¬nh áº£nh
- **GitHub**: Kho lÆ°u trá»¯ mÃ£ nguá»“n

### Báº£o máº­t
- **JWT Authentication**: XÃ¡c thá»±c ngÆ°á»i dÃ¹ng
- **Bcrypt Password Hashing**: MÃ£ hÃ³a máº­t kháº©u
- **CORS Protection**: Báº£o vá»‡ yÃªu cáº§u Ä‘a nguá»“n gá»‘c
- **Helmet Security Headers**: Báº£o máº­t HTTP headers
- **Rate Limiting**: Giá»›i háº¡n tá»‘c Ä‘á»™ yÃªu cáº§u
- **Input Validation**: Kiá»ƒm tra dá»¯ liá»‡u Ä‘áº§u vÃ o
- **SQL Injection Prevention**: Báº£o vá»‡ cÆ¡ sá»Ÿ dá»¯ liá»‡u
- **XSS Protection**: Báº£o vá»‡ táº¥n cÃ´ng XSS
- **CSRF Protection**: Báº£o vá»‡ táº¥n cÃ´ng CSRF

### Hiá»‡u suáº¥t & Tá»‘i Æ°u hÃ³a
- **React Query Caching**: Quáº£n lÃ½ bá»™ nhá»› Ä‘á»‡m
- **Image Optimization**: Tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh
- **Code Splitting**: Chia nhá» bundle
- **Lazy Loading**: Táº£i components khi cáº§n
- **Database Indexing**: Tá»‘i Æ°u truy váº¥n
- **Connection Pooling**: Quáº£n lÃ½ káº¿t ná»‘i cÆ¡ sá»Ÿ dá»¯ liá»‡u
- **Compression**: NÃ©n dá»¯ liá»‡u pháº£n há»“i
- **Caching**: Bá»™ nhá»› Ä‘á»‡m tÃ i nguyÃªn tÄ©nh

## Nhá»¯ng thiáº¿u sÃ³t 
Dá»± Ã¡n vá» cÆ¡ báº£n hoÃ n thiá»‡n cÃ¡c tÃ­nh nÄƒng cá»§a má»™t trang thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­, má»™t sÃ n giao dá»‹ch trung gian giá»¯a ngÆ°á»i dÃ¹ng vÃ  ngÆ°á»i dÃ¹ng (mÃ´ hÃ¬nh P2P). NhÆ°ng cÅ©ng cÃ³ nhá»¯ng thiáº¿u sÃ³t vá»›i yÃªu cáº§u ban Ä‘áº§u cá»§a GiÃ¡o viÃªn hÆ°á»›ng dáº«n:
- ChÆ°a tÃ­ch há»£p Smart Constract Ä‘á»ƒ tÄƒng tÃ­nh minh báº¡ch
   + LÃ½ do:
      + PhÃ­ gas cao: Chi phÃ­ giao dá»‹ch (gas fee) trÃªn cÃ¡c máº¡ng blockchain hiá»‡n táº¡i (vÃ­ dá»¥: Ethereum) quÃ¡ cao, gÃ¢y gÃ¡nh náº·ng tÃ i chÃ­nh Ä‘Ã¡ng ká»ƒ cho ngÆ°á»i dÃ¹ng vÃ  lÃ m giáº£m tÃ­nh kháº£ thi cá»§a viá»‡c triá»ƒn khai rá»™ng rÃ£i.
      + Háº¡n cháº¿ vá» tÃ i nguyÃªn: Viá»‡c tÃ¬m kiáº¿m giáº£i phÃ¡p tá»‘i Æ°u hÃ³a gas fee gáº·p nhiá»u khÃ³ khÄƒn. Äá»“ng thá»i, lÆ°á»£ng SepoliaETH (máº¡ng thá»­ nghiá»‡m) hiá»‡n cÃ³ khÃ´ng Ä‘á»§ Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thá»­ nghiá»‡m vÃ  triá»ƒn khai Smart Contract má»™t cÃ¡ch Ä‘áº§y Ä‘á»§.
   + TÃ¡c Ä‘á»™ng: Viá»‡c khÃ´ng tÃ­ch há»£p Smart Contract áº£nh hÆ°á»Ÿng Ä‘áº¿n kháº£ nÄƒng cung cáº¥p má»©c Ä‘á»™ minh báº¡ch tuyá»‡t Ä‘á»‘i vÃ  tá»± Ä‘á»™ng hÃ³a giao dá»‹ch mÃ  cÃ´ng nghá»‡ blockchain cÃ³ thá»ƒ mang láº¡i.
   + Biá»‡n phÃ¡p kháº¯c phá»¥c: sá»­ dá»¥ng VNPay thay thá»ƒ, nhÆ°ng váº«n Ã¡p dá»¥ng cÆ¡ cháº¿ escrow thÃ´ng qua phÆ°Æ¡ng thá»©c khÃ³a vÃ­ táº¡m thá»i. 
- ChÆ°a cÃ³ há»‡ thá»‘ng ghi nháº­n giao dá»‹ch báº±ng blockchain vÃ  cÃ´ng khai lÃªn toÃ n bá»™ ngÆ°á»i dÃ¹ng. 
## Äá»‹nh hÆ°á»›ng phÃ¡t triá»ƒn trong tÆ°Æ¡ng lai

Dá»± Ã¡n Ä‘ang trong giai Ä‘oáº¡n phÃ¡t triá»ƒn. HÆ°á»›ng phÃ¡t triá»ƒn tiáº¿p theo cho Ä‘á»“ Ã¡n
- TÃ­ch há»£p thÃªm phÆ°Æ¡ng thá»©c thanh toÃ¡n (Momo, Visa, Paypal,... )
- TÃ­ch há»£p thÃªm há»‡ thá»‘ng thanh toÃ¡n báº±ng blockchain, Smart Contracts. KhÃ¡m phÃ¡ cÃ¡c Layer 2 solutions hoáº·c cÃ¡c ná»n táº£ng blockchain khÃ¡c vá»›i chi phÃ­ giao dá»‹ch tháº¥p hÆ¡n, nháº±m Ä‘Ã¡p á»©ng Ä‘áº§y Ä‘á»§ yÃªu cáº§u vá» tÃ­nh minh báº¡ch tuyá»‡t Ä‘á»‘i trong tÆ°Æ¡ng lai.
- ThÃªm tÃ­nh nÄƒng "Biáº¿n Ä‘á»™ng sá»‘ dÆ°" thÃ´ng qua dá»¯ liá»‡u lÆ°u trong báº£ng transacstions
- Cáº£i thiá»‡n há»‡ thá»‘ng chat, thÃªm thÃ´ng bÃ¡o thá»i gian thá»±c
- PhÃ¡t triá»ƒn á»©ng dá»¥ng di Ä‘á»™ng

## Giáº¥y phÃ©p

Dá»± Ã¡n nÃ y Ä‘Æ°á»£c phÃ¡t triá»ƒn cho má»¥c Ä‘Ã­ch há»c táº­p vÃ  nghiÃªn cá»©u.

## LiÃªn há»‡

Äá»ƒ biáº¿t thÃªm thÃ´ng tin, vui lÃ²ng liÃªn há»‡ qua email: 7vits.shop@gmail.com


